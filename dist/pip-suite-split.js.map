{"version":3,"sources":["../node_modules/browser-pack/_prelude.js","src/ISplitService.ts","src/SplitService.ts","src/index.ts"],"names":[],"mappings":"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","file":"pip-suite-split.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","export interface ISplitService {\n    forwardTransition(toState: any, fromState: any): boolean;\n    goToDesktopState(fromState: string): string;\n}\n\nexport interface ISplitProvider {\n    addTransitionSequence(sequence: string[], mobileStates?: MobileState[]): void;\n}\n\nexport class MobileState {\n    name: string;\n    toStateName: string;\n}","/// <reference path=\"../typings/tsd.d.ts\" />\n\nimport {\n    ISplitService,\n    ISplitProvider,\n    MobileState\n} from './ISplitService';\n\n{\n    const run = function (\n        $rootScope: ng.IRootScopeService, pipSplit: ISplitService, $state: ng.ui.IStateService\n    ) {\n        $rootScope.$on('$stateChangeStart',\n            (event, toState, toParams, fromState, fromParams) => {\n                // Split animation\n                const splitElements = $('.pip-split');\n\n                if (splitElements.length > 0) {\n                    splitElements.removeClass('pip-transition-forward');\n                    splitElements.removeClass('pip-transition-back');\n                    if (toState.name != fromState.name) {\n                        if (pipSplit.forwardTransition(toState, fromState)) {\n                            splitElements.addClass('pip-transition-forward');\n                        } else {\n                            splitElements.addClass('pip-transition-back');\n                        }\n                    }\n                }\n            }\n        );\n\n        const debounceResize = _.debounce(() => {\n            const toState = pipSplit.goToDesktopState($state.current.name);\n            if (toState) $state.go(toState, $state.current.params);\n        }, 100);\n\n        $rootScope.$on(pip.layouts.MainResizedEvent, (\n            event: ng.IAngularEvent,\n            breakpoints: pip.layouts.MediaBreakpointStatuses\n        ) => {\n            if (!breakpoints.xs) {\n                debounceResize();\n            }\n        });\n\n    }\n\n    class SplitService implements ISplitService {\n        constructor(\n            private transitionSequences: any,\n            private mobileStates: any\n        ) {}\n\n        public forwardTransition(toState, fromState) {\n            for (let i = 0; i < this.transitionSequences.length; i++) {\n                const toIndex = this.transitionSequences[i].indexOf(toState.name);\n                const fromIndex = this.transitionSequences[i].indexOf(fromState.name);\n\n                if (toIndex > -1) {\n                    return toIndex > fromIndex;\n                }\n            }\n\n            return false\n        }\n\n        public goToDesktopState(fromState: string): string {\n            for (let i = 0; i < this.mobileStates.length; i++) {\n                const fromIndex = _.findIndex(this.mobileStates[i], (state: MobileState) => {\n                    return state.name === fromState;\n                })\n\n                if (fromIndex > -1) {\n                    return this.mobileStates[i][fromIndex].toState;\n                }\n            }\n\n            return '';\n        }\n    }\n\n    class SplitProvider implements ISplitProvider {\n        private transitionSequences: any = [];\n        private mobileStates: any = [];\n        private _service: ISplitService;\n\n        constructor() {}\n\n        public addTransitionSequence(sequence: string[], mobileStates ? : MobileState[]) {\n            if (!_.isArray(sequence) || sequence.length == 0) {\n                throw new Error('Transition sequence must be an array of state names');\n            }\n\n            this.transitionSequences.push(sequence);\n            this.mobileStates.push(mobileStates);\n        }\n\n        public $get() {\n            \"ngInject\";\n\n            if (this._service == null)\n                this._service = new SplitService(this.transitionSequences, this.mobileStates);\n\n            return this._service;\n        }\n    }\n\n    angular.module('pipSplit', [])\n        .run(run)\n        .provider('pipSplit', SplitProvider);\n}","/// <reference path=\"../typings/tsd.d.ts\" />\n\nangular.module('pipSplit', []);\n\nimport './SplitService';\n\nexport * from './ISplitService';"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvSVNwbGl0U2VydmljZS50cyIsInNyYy9TcGxpdFNlcnZpY2UudHMiLCJzcmMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7OztBQ1NBO0lBQUE7SUFHQSxDQUFDO0lBQUQsa0JBQUM7QUFBRCxDQUhBLEFBR0MsSUFBQTtBQUhZLGtDQUFXOzs7O0FDRHhCLENBQUM7SUFDRyxJQUFNLEdBQUcsR0FBRyxVQUNSLFVBQWdDLEVBQUUsUUFBdUIsRUFBRSxNQUEyQjtRQUV0RixVQUFVLENBQUMsR0FBRyxDQUFDLG1CQUFtQixFQUM5QixVQUFDLEtBQUssRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxVQUFVO1lBRTVDLElBQU0sYUFBYSxHQUFHLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUV0QyxFQUFFLENBQUMsQ0FBQyxhQUFhLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzNCLGFBQWEsQ0FBQyxXQUFXLENBQUMsd0JBQXdCLENBQUMsQ0FBQztnQkFDcEQsYUFBYSxDQUFDLFdBQVcsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO2dCQUNqRCxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxJQUFJLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO29CQUNqQyxFQUFFLENBQUMsQ0FBQyxRQUFRLENBQUMsaUJBQWlCLENBQUMsT0FBTyxFQUFFLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQzt3QkFDakQsYUFBYSxDQUFDLFFBQVEsQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO29CQUNyRCxDQUFDO29CQUFDLElBQUksQ0FBQyxDQUFDO3dCQUNKLGFBQWEsQ0FBQyxRQUFRLENBQUMscUJBQXFCLENBQUMsQ0FBQztvQkFDbEQsQ0FBQztnQkFDTCxDQUFDO1lBQ0wsQ0FBQztRQUNMLENBQUMsQ0FDSixDQUFDO1FBRUYs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LHFEQUFxRCxDQUFDLENBQUM7WUFDM0UsQ0FBQztZQUVELElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDeEMsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDekMsQ0FBQztRQUVNLDRCQUFJLEdBQVg7WUFDSSxVQUFVLENBQUM7WUFFWCxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQztnQkFDdEIsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLGNBQVksQ0FBQyxJQUFJLENBQUMsbUJBQW1CLEVBQUUsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBRWxGLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDO1FBQ3pCLENBQUM7UUFDTCxvQkFBQztJQUFELENBeEJBLEFBd0JDLElBQUE7SUFFRCxPQUFPLENBQUMsTUFBTSxDQUFDLFVBQVUsRUFBRSxFQUFFLENBQUM7U0FDekIsR0FBRyxDQUFDLEdBQUcsQ0FBQztTQUNSLFFBQVEsQ0FBQyxVQUFVLEVBQUUsYUFBYSxDQUFDLENBQUM7QUFDN0MsQ0FBQzs7Ozs7OztBQzVHRCxPQUFPLENBQUMsTUFBTSxDQUFDLFVBQVUsRUFBRSxFQUFFLENBQUMsQ0FBQztBQUUvQiwwQkFBd0I7QUFFeEIscUNBQWdDIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwiZXhwb3J0IGludGVyZmFjZSBJU3BsaXRTZXJ2aWNlIHtcbiAgICBmb3J3YXJkVHJhbnNpdGlvbih0b1N0YXRlOiBhbnksIGZyb21TdGF0ZTogYW55KTogYm9vbGVhbjtcbiAgICBnb1RvRGVza3RvcFN0YXRlKGZyb21TdGF0ZTogc3RyaW5nKTogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIElTcGxpdFByb3ZpZGVyIHtcbiAgICBhZGRUcmFuc2l0aW9uU2VxdWVuY2Uoc2VxdWVuY2U6IHN0cmluZ1tdLCBtb2JpbGVTdGF0ZXM/OiBNb2JpbGVTdGF0ZVtdKTogdm9pZDtcbn1cblxuZXhwb3J0IGNsYXNzIE1vYmlsZVN0YXRlIHtcbiAgICBuYW1lOiBzdHJpbmc7XG4gICAgdG9TdGF0ZU5hbWU6IHN0cmluZztcbn0iLCIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vdHlwaW5ncy90c2QuZC50c1wiIC8+XG5cbmltcG9ydCB7XG4gICAgSVNwbGl0U2VydmljZSxcbiAgICBJU3BsaXRQcm92aWRlcixcbiAgICBNb2JpbGVTdGF0ZVxufSBmcm9tICcuL0lTcGxpdFNlcnZpY2UnO1xuXG57XG4gICAgY29uc3QgcnVuID0gZnVuY3Rpb24gKFxuICAgICAgICAkcm9vdFNjb3BlOiBuZy5JUm9vdFNjb3BlU2VydmljZSwgcGlwU3BsaXQ6IElTcGxpdFNlcnZpY2UsICRzdGF0ZTogbmcudWkuSVN0YXRlU2VydmljZVxuICAgICkge1xuICAgICAgICAkcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlU3RhcnQnLFxuICAgICAgICAgICAgKGV2ZW50LCB0b1N0YXRlLCB0b1BhcmFtcywgZnJvbVN0YXRlLCBmcm9tUGFyYW1zKSA9PiB7XG4gICAgICAgICAgICAgICAgLy8gU3BsaXQgYW5pbWF0aW9uXG4gICAgICAgICAgICAgICAgY29uc3Qgc3BsaXRFbGVtZW50cyA9ICQoJy5waXAtc3BsaXQnKTtcblxuICAgICAgICAgICAgICAgIGlmIChzcGxpdEVsZW1lbnRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgc3BsaXRFbGVtZW50cy5yZW1vdmVDbGFzcygncGlwLXRyYW5zaXRpb24tZm9yd2FyZCcpO1xuICAgICAgICAgICAgICAgICAgICBzcGxpdEVsZW1lbnRzLnJlbW92ZUNsYXNzKCdwaXAtdHJhbnNpdGlvbi1iYWNrJyk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0b1N0YXRlLm5hbWUgIT0gZnJvbVN0YXRlLm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwaXBTcGxpdC5mb3J3YXJkVHJhbnNpdGlvbih0b1N0YXRlLCBmcm9tU3RhdGUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BsaXRFbGVtZW50cy5hZGRDbGFzcygncGlwLXRyYW5zaXRpb24tZm9yd2FyZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGxpdEVsZW1lbnRzLmFkZENsYXNzKCdwaXAtdHJhbnNpdGlvbi1iYWNrJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG5cbiAgICAgICAgY29uc3QgZGVib3VuY2VSZXNpemUgPSBfLmRlYm91bmNlKCgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHRvU3RhdGUgPSBwaXBTcGxpdC5nb1RvRGVza3RvcFN0YXRlKCRzdGF0ZS5jdXJyZW50Lm5hbWUpO1xuICAgICAgICAgICAgaWYgKHRvU3RhdGUpICRzdGF0ZS5nbyh0b1N0YXRlLCAkc3RhdGUuY3VycmVudC5wYXJhbXMpO1xuICAgICAgICB9LCAxMDApO1xuXG4gICAgICAgICRyb290U2NvcGUuJG9uKHBpcC5sYXlvdXRzLk1haW5SZXNpemVkRXZlbnQsIChcbiAgICAgICAgICAgIGV2ZW50OiBuZy5JQW5ndWxhckV2ZW50LFxuICAgICAgICAgICAgYnJlYWtwb2ludHM6IHBpcC5sYXlvdXRzLk1lZGlhQnJlYWtwb2ludFN0YXR1c2VzXG4gICAgICAgICkgPT4ge1xuICAgICAgICAgICAgaWYgKCFicmVha3BvaW50cy54cykge1xuICAgICAgICAgICAgICAgIGRlYm91bmNlUmVzaXplKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgfVxuXG4gICAgY2xhc3MgU3BsaXRTZXJ2aWNlIGltcGxlbWVudHMgSVNwbGl0U2VydmljZSB7XG4gICAgICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICAgICAgcHJpdmF0ZSB0cmFuc2l0aW9uU2VxdWVuY2VzOiBhbnksXG4gICAgICAgICAgICBwcml2YXRlIG1vYmlsZVN0YXRlczogYW55XG4gICAgICAgICkge31cblxuICAgICAgICBwdWJsaWMgZm9yd2FyZFRyYW5zaXRpb24odG9TdGF0ZSwgZnJvbVN0YXRlKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudHJhbnNpdGlvblNlcXVlbmNlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRvSW5kZXggPSB0aGlzLnRyYW5zaXRpb25TZXF1ZW5jZXNbaV0uaW5kZXhPZih0b1N0YXRlLm5hbWUpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGZyb21JbmRleCA9IHRoaXMudHJhbnNpdGlvblNlcXVlbmNlc1tpXS5pbmRleE9mKGZyb21TdGF0ZS5uYW1lKTtcblxuICAgICAgICAgICAgICAgIGlmICh0b0luZGV4ID4gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRvSW5kZXggPiBmcm9tSW5kZXg7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgfVxuXG4gICAgICAgIHB1YmxpYyBnb1RvRGVza3RvcFN0YXRlKGZyb21TdGF0ZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5tb2JpbGVTdGF0ZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCBmcm9tSW5kZXggPSBfLmZpbmRJbmRleCh0aGlzLm1vYmlsZVN0YXRlc1tpXSwgKHN0YXRlOiBNb2JpbGVTdGF0ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RhdGUubmFtZSA9PT0gZnJvbVN0YXRlO1xuICAgICAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgICAgICBpZiAoZnJvbUluZGV4ID4gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubW9iaWxlU3RhdGVzW2ldW2Zyb21JbmRleF0udG9TdGF0ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNsYXNzIFNwbGl0UHJvdmlkZXIgaW1wbGVtZW50cyBJU3BsaXRQcm92aWRlciB7XG4gICAgICAgIHByaXZhdGUgdHJhbnNpdGlvblNlcXVlbmNlczogYW55ID0gW107XG4gICAgICAgIHByaXZhdGUgbW9iaWxlU3RhdGVzOiBhbnkgPSBbXTtcbiAgICAgICAgcHJpdmF0ZSBfc2VydmljZTogSVNwbGl0U2VydmljZTtcblxuICAgICAgICBjb25zdHJ1Y3RvcigpIHt9XG5cbiAgICAgICAgcHVibGljIGFkZFRyYW5zaXRpb25TZXF1ZW5jZShzZXF1ZW5jZTogc3RyaW5nW10sIG1vYmlsZVN0YXRlcyA/IDogTW9iaWxlU3RhdGVbXSkge1xuICAgICAgICAgICAgaWYgKCFfLmlzQXJyYXkoc2VxdWVuY2UpIHx8IHNlcXVlbmNlLmxlbmd0aCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUcmFuc2l0aW9uIHNlcXVlbmNlIG11c3QgYmUgYW4gYXJyYXkgb2Ygc3RhdGUgbmFtZXMnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy50cmFuc2l0aW9uU2VxdWVuY2VzLnB1c2goc2VxdWVuY2UpO1xuICAgICAgICAgICAgdGhpcy5tb2JpbGVTdGF0ZXMucHVzaChtb2JpbGVTdGF0ZXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgcHVibGljICRnZXQoKSB7XG4gICAgICAgICAgICBcIm5nSW5qZWN0XCI7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLl9zZXJ2aWNlID09IG51bGwpXG4gICAgICAgICAgICAgICAgdGhpcy5fc2VydmljZSA9IG5ldyBTcGxpdFNlcnZpY2UodGhpcy50cmFuc2l0aW9uU2VxdWVuY2VzLCB0aGlzLm1vYmlsZVN0YXRlcyk7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zZXJ2aWNlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3BpcFNwbGl0JywgW10pXG4gICAgICAgIC5ydW4ocnVuKVxuICAgICAgICAucHJvdmlkZXIoJ3BpcFNwbGl0JywgU3BsaXRQcm92aWRlcik7XG59IiwiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uL3R5cGluZ3MvdHNkLmQudHNcIiAvPlxuXG5hbmd1bGFyLm1vZHVsZSgncGlwU3BsaXQnLCBbXSk7XG5cbmltcG9ydCAnLi9TcGxpdFNlcnZpY2UnO1xuXG5leHBvcnQgKiBmcm9tICcuL0lTcGxpdFNlcnZpY2UnOyJdfQ=="}